sudo: false

language: cpp

os:
  - osx

compiler:
  - clang
#  - gcc

# Only build the master branch, otherwise once the release is added, Github
# creates a tag which triggers another identical build.
branches:
  only:
    - master

before_install:
  - brew update

install:
  - if [ "$CXX" = "g++" ]; then export CXX="g++-4.8" CC="gcc-4.8"; fi
  - brew unlink boost

script:
  - brew install --verbose --build-bottle boost --c++11
  - brew bottle boost

before_deploy:
  - export RELEASE_FILES=$(ls *.bottle.tar.gz)
  - "echo 'Deploying files to Github: '$RELEASE_FILES"

deploy:
  provider: releases
  api_key:
    secure: "OB0ausYntt4yWPIUooQbKD2okR7w4EyLctvxva/n3MVapLWiNyFVqLbyBW9gJNOeq7k7X7zN9H59rqXJ7wKCxlPjKxFXmNvfqPYOcRj34tLcInv6AFUXIT5mYFpaJTLpG7r4wA3kOiHIeozSoIgb7evOId6bAR8JcLbSlqgFqPJrvDfKxo+IzNVykSQiyIqjTAgt3L92c6gfLy7qENkhcjtxCh79OejVR1gbDyPNlo9Rmp3B1tIc0nnFM154MFJ50ZkKMnmXfx/9MG6difhrcCUZtHuMN+8aXar7yGoUCuqcUJkpbi2NtDTI61ogXGOp/twS1kjUAW3UCqAsj4/yF9vGCAaWI9iL4nL/N3Q9v3PcthjEtOXACIXL3TI/KhxhMU+47yerx9UqqtCn0nnYPpdd9FtT1oEVbRVca3TQ84L9AoHkqVFSUmjJ20a0OK9tLdi57AvLbXdhB6Q3g3DW/8XTp042x4yaZxeCLw9qcK/2Q3rWI+1MBAQeVI3C2/xs25/NSotFAlq3p1nIPrq6ZuhClH1GOMIheS5+19SLNn9FPoWoTUz5AIYW3Xe0+9vyEBHzJKhMB9fF3ahfduFbsRALt7NQCjSH38F6v0pqtYMe65eQIUpNXfdT5RdMZloQxSPOvnNU6ElaWXOc6lIalTGZ5Fdp3sV+QhNeYeAcvQU="
  file: "${RELEASE_FILES}"
  skip_cleanup: true
  on:
    repo: uclatommy/travis-homebrew-bottle
  overwrite: true
